import{r as n,h as N,j as t}from"./index-CcQ31UA2.js";import{A as k}from"./appointmentAPI-D2AChQuS.js";import{a as j}from"./index.esm-DMOZoxqD.js";import{C as F,a as A,b as p,c as r,d as D,e as a}from"./CTable-CJv6Qvvu.js";const Q=()=>{const[h,m]=n.useState([]),[S,x]=n.useState(!0),[c,g]=n.useState([]),[E,B]=n.useState([]),y=N(),[l,u]=n.useState([]),[H,V]=n.useState([]),[R,$]=n.useState(1),[L,v]=n.useState([]),[z,b]=n.useState([]),[M,P]=n.useState([]),[X,q]=n.useState([]),[C,I]=n.useState(null),T={"Service & Treatment":"services & treatments","Video Consultation":"online consultation","In-clinic":"in-clinic consultation"},f=async e=>{try{const s=await k();if(s&&s.data){const o=e?s.data.filter(d=>i(d.clinicId)===i(e)):s.data;g(o||[]),x(!1)}}catch(s){console.error("Failed to fetch appointments:",s),g([]),x(!1)}};n.useEffect(()=>{const e=localStorage.getItem("HospitalId");e?(I(e),f(e)):(console.warn("No HospitalId found in localStorage. Displaying all relevant appointments."),f(null))},[]),n.useEffect(()=>{let e=c.filter(s=>i(s.status)==="completed");if(l.length===1){const s=l[0],o=T[s];o&&(e=e.filter(d=>i(d.consultationType)===o))}m(e)},[c,l,C]),n.useEffect(()=>{const e=[...new Set(c.map(o=>o.servicename).filter(Boolean))],s=[...new Set(c.map(o=>o.consultationType).filter(Boolean))];v(e),b(s),console.log("Available Consultation Types:",s)},[c]);const w=e=>{l.includes(e)?u([]):u([e])};n.useEffect(()=>{let e=c;if(e=e.filter(s=>i(s.status)==="completed"),l.length===1){const s=l[0];if(s==="Video Consultation")e=e.filter(o=>i(o.consultationType)==="video consultation"||i(o.consultationType)==="online consultation");else{const o=T[s];o&&(e=e.filter(d=>i(d.consultationType)===o))}}m(e)},[c,l]),n.useEffect(()=>{const e=localStorage.getItem("HospitalId");e?f(e):console.warn("No HospitalId in localStorage")},[]);const i=e=>e==null?void 0:e.toLowerCase().trim();return t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("div",{className:"container mt-4",children:[t.jsx("h5",{className:"mb-3",children:"Appointments"}),t.jsx("div",{className:"d-flex gap-2 mb-3",children:["Service & Treatment","In-clinic","Video Consultation"].map(e=>t.jsx("button",{onClick:()=>w(e),className:`btn ${l.includes(e)?"btn-dark":"btn-outline-dark"}`,children:e},e))}),t.jsx("div",{className:"mb-3",children:t.jsx(j,{color:"secondary",onClick:()=>u([]),children:"Reset Filters"})}),t.jsxs(F,{striped:!0,hover:!0,responsive:!0,children:[t.jsx(A,{children:t.jsxs(p,{children:[t.jsx(r,{children:"S.No"}),t.jsx(r,{children:"Name"}),t.jsx(r,{children:"Consultation Type"}),t.jsx(r,{children:"Date"}),t.jsx(r,{children:"Time"}),t.jsx(r,{children:"Status"}),t.jsx(r,{children:"Action"})]})}),t.jsx(D,{children:S?t.jsx(p,{children:t.jsx(a,{colSpan:"8",className:"text-center text-primary fw-bold",children:"Loading reports..."})}):h.length>0?h.map((e,s)=>t.jsxs(p,{children:[t.jsx(a,{children:s+1}),t.jsx(a,{children:e.name}),t.jsx(a,{children:e.consultationType}),t.jsx(a,{children:e.serviceDate}),t.jsx(a,{children:e.slot||e.servicetime}),t.jsx(a,{children:e.status}),t.jsx(a,{children:t.jsx(j,{color:"primary",size:"sm",onClick:()=>y(`/reportDetails/${e.bookingId}`,{state:{report:e,appointmentInfo:{name:e.name,age:e.age,gender:e.gender,problem:e.problem,bookingId:e.bookingId,item:e}}}),children:"View"})})]},`${e.bookingId}-${s}`)):t.jsx(p,{children:t.jsx(a,{colSpan:"8",className:"text-center text-danger fw-bold",children:"No completed appointments found."})})})]})]})})};export{Q as default};
